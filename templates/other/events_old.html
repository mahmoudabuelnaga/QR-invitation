{% extends 'base.html' %}
{% load static %}
{% block extra_css %}
<link href="{% static 'css/tables/table-basic.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'plugins/flatpickr/flatpickr.css' %}" rel="stylesheet" type="text/css">
<link href="{% static 'plugins/flatpickr/custom-flatpickr.css' %}" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="{% static 'styles.min.css' %}">
{% endblock %}
{% block content %}
{% include "_modal.html" %}
<div style="display:none;">
<pixie-editor>

	<div class="global-spinner">
		<style>.global-spinner {display: none; align-items: center; justify-content: center; z-index: 999; background: #fff; position: fixed; top: 0; left: 0; width: 100%; height: 100%;}</style>
		<style>.la-ball-spin-clockwise,.la-ball-spin-clockwise>div{position:relative;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.la-ball-spin-clockwise{display:block;font-size:0;color:#1976d2}.la-ball-spin-clockwise.la-dark{color:#333}.la-ball-spin-clockwise>div{display:inline-block;float:none;background-color:currentColor;border:0 solid currentColor}.la-ball-spin-clockwise{width:32px;height:32px}.la-ball-spin-clockwise>div{position:absolute;top:50%;left:50%;width:8px;height:8px;margin-top:-4px;margin-left:-4px;border-radius:100%;-webkit-animation:ball-spin-clockwise 1s infinite ease-in-out;-moz-animation:ball-spin-clockwise 1s infinite ease-in-out;-o-animation:ball-spin-clockwise 1s infinite ease-in-out;animation:ball-spin-clockwise 1s infinite ease-in-out}.la-ball-spin-clockwise>div:nth-child(1){top:5%;left:50%;-webkit-animation-delay:-.875s;-moz-animation-delay:-.875s;-o-animation-delay:-.875s;animation-delay:-.875s}.la-ball-spin-clockwise>div:nth-child(2){top:18.1801948466%;left:81.8198051534%;-webkit-animation-delay:-.75s;-moz-animation-delay:-.75s;-o-animation-delay:-.75s;animation-delay:-.75s}.la-ball-spin-clockwise>div:nth-child(3){top:50%;left:95%;-webkit-animation-delay:-.625s;-moz-animation-delay:-.625s;-o-animation-delay:-.625s;animation-delay:-.625s}.la-ball-spin-clockwise>div:nth-child(4){top:81.8198051534%;left:81.8198051534%;-webkit-animation-delay:-.5s;-moz-animation-delay:-.5s;-o-animation-delay:-.5s;animation-delay:-.5s}.la-ball-spin-clockwise>div:nth-child(5){top:94.9999999966%;left:50.0000000005%;-webkit-animation-delay:-.375s;-moz-animation-delay:-.375s;-o-animation-delay:-.375s;animation-delay:-.375s}.la-ball-spin-clockwise>div:nth-child(6){top:81.8198046966%;left:18.1801949248%;-webkit-animation-delay:-.25s;-moz-animation-delay:-.25s;-o-animation-delay:-.25s;animation-delay:-.25s}.la-ball-spin-clockwise>div:nth-child(7){top:49.9999750815%;left:5.0000051215%;-webkit-animation-delay:-.125s;-moz-animation-delay:-.125s;-o-animation-delay:-.125s;animation-delay:-.125s}.la-ball-spin-clockwise>div:nth-child(8){top:18.179464974%;left:18.1803700518%;-webkit-animation-delay:0s;-moz-animation-delay:0s;-o-animation-delay:0s;animation-delay:0s}.la-ball-spin-clockwise.la-sm{width:16px;height:16px}.la-ball-spin-clockwise.la-sm>div{width:4px;height:4px;margin-top:-2px;margin-left:-2px}.la-ball-spin-clockwise.la-2x{width:64px;height:64px}.la-ball-spin-clockwise.la-2x>div{width:16px;height:16px;margin-top:-8px;margin-left:-8px}.la-ball-spin-clockwise.la-3x{width:96px;height:96px}.la-ball-spin-clockwise.la-3x>div{width:24px;height:24px;margin-top:-12px;margin-left:-12px}@-webkit-keyframes ball-spin-clockwise{0%,100%{opacity:1;-webkit-transform:scale(1);transform:scale(1)}20%{opacity:1}80%{opacity:0;-webkit-transform:scale(0);transform:scale(0)}}@-moz-keyframes ball-spin-clockwise{0%,100%{opacity:1;-moz-transform:scale(1);transform:scale(1)}20%{opacity:1}80%{opacity:0;-moz-transform:scale(0);transform:scale(0)}}@-o-keyframes ball-spin-clockwise{0%,100%{opacity:1;-o-transform:scale(1);transform:scale(1)}20%{opacity:1}80%{opacity:0;-o-transform:scale(0);transform:scale(0)}}@keyframes ball-spin-clockwise{0%,100%{opacity:1;-webkit-transform:scale(1);-moz-transform:scale(1);-o-transform:scale(1);transform:scale(1)}20%{opacity:1}80%{opacity:0;-webkit-transform:scale(0);-moz-transform:scale(0);-o-transform:scale(0);transform:scale(0)}}</style>
		<div class="la-ball-spin-clockwise la-2x">

			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
		</div>
	</div>
	<script>setTimeout(function() {
		var spinner = document.querySelector('.global-spinner');
		if (spinner) spinner.style.display = 'flex';
	}, 50);</script>
</pixie-editor>
</div>

<div class="row layout-top-spacing">
                     <div id="tableFooter" class="col-lg-12 col-12 layout-spacing">
                            <div class="statbox widget box box-shadow">
                                <div class="widget-header">
                                    <div class="row">
                                        <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                            <h4>My Events <a href="#" class="create-event">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus-circle"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg>
                                                </a>
                                            </h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="widget-content widget-content-area">
                                    <div class="table-responsive">
                                                            <div id="wait" style="display:none;width:69px;height:89px;border:1px solid black;position:absolute;top:50%;left:50%;padding:2px;"><img src="{% static 'images/ajax-loader.gif' %}" width="64" height="64" /><br>Loading..</div>

                                        <table class="table table-bordered table-hover table-condensed mb-4">
                                            <thead>
                                                <tr>
                                                    <th>Barcode Design</th>
                                                    <th>Event Name</th>
                                                    <th>Event Date</th>
                                                    <th>Total Guest</th>
                                                    <th class="text-center">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            {% for event in events %}
                                                <tr>

                                                    {% if event.image_state %}
                                                    <td>
                                                        <a href="{% url 'design' event.pk  %}"> <img src="media/{{event.image}}" height="140" width="140"></a>
                                                        <a href="{% url 'download' event.pk  %}">Download this image!</a>

                                                    </td>
                                                    {% else %}
                                                    <td><a href="{% url 'design' event.pk  %}"> + create new design </a></td>
                                                    {% endif %}
                                                    <td>{{ event.event_name }}</td>
                                                    <td>{{ event.event_date }}</td>
                                                    <td><a href="{% url 'guests' event.pk  %}">{{ event.guest_count }}</a>  <a href="#" class="create_guest_in_event_page" data-id="{% url 'create_guest_in_event_page' event.pk %}"> add more guest </a> </td>
                                                    <td class="text-center">
                                                        <ul class="table-controls">
                                                            <li>
                                                                <a href="#" data-id="{{ event.pk }}" class="download">download</a>
                                                                <a href="#"  class="update-event" data-toggle="tooltip" data-placement="top" data-id="{% url 'update_event' event.pk %}"
                                                                   title="Edit"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                                                                     fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                                                                     stroke-linejoin="round" class="feather feather-check-circle text-primary">
                                                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                                                <polyline points="22 4 12 14.01 9 11.01"></polyline></svg></a>
                                                            </li>
                                                            <li>
                                                                <a href="#" class="delete-event" data-toggle="tooltip" data-placement="top" title="Delete" data-id="{% url 'delete_event' event.pk %}">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x-circle text-danger">
                                                                    <circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15">

                                                                </line><line x1="9" y1="9" x2="15" y2="15"></line></svg></a>
                                                            </li>
                                                        </ul>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                </div>
{% endblock %}
{% block extra_javascript %}

<!-- For popup modal -->
<script src="{% static 'js/jquery.bootstrap.modal.forms.js' %}"></script>
<!-- You can alternatively load the minified version -->
<script src="{% static 'js/jquery.bootstrap.modal.forms.min.js' %}"></script>

<script>
    $(document).ready(function() {
   // Create event button
      $(".create-event").modalForm({formURL: "{% url 'create_event' %}", modalID: "#create-modal"});

  });
   // Update event buttons
    $(".update-event").each(function () {
      $(this).modalForm({formURL: $(this).data('id')});
    });

    // Delete event buttons
    $(".delete-event").each(function () {
      $(this).modalForm({formURL: $(this).data('id')});
    });

     // Update Guest buttons
    $(".create_guest_in_event_page").each(function () {
      $(this).modalForm({formURL: $(this).data('id')});
    });


  </script>
<script src="{% static 'scripts.min.js' %}"></script>
<script>
  $(".download").on('click', function(event) {
    var event_id=$(this).data('id');
  $.ajax({
        url: '{% url "getGuestIDs" %}',
        data: {'event_id': event_id},
        dataType: 'json',
        success: saveImage
});
});
</script>
<script>
    function saveImage(responseData)
    {
     var pixie = new Pixie({
	 baseUrl: 'http://127.0.0.1:8000',
	 ui: {
  		openImageDialog: {
  			show: false
  		}
  	  },
     onLoad: function() {
     setTimeout(function() {
     var completed=0;
      $.each(responseData, function(i, item) {
            var guest_id = item.id;
            var event_id = item.event_id_id;
            var guest_state = item.state;
              pixie.get('import').loadStateFromUrl('media/' + guest_state).then(function() {
               var base64ImageData = pixie.getTool('export').getDataUrl('png');
                 pixie.http().post('{% url "convert_data_to_image_per_guest" %}', {completed:completed,event_id:event_id,guest_id:guest_id,name: name, data: base64ImageData}).subscribe(function(response) {
               });
              });
		  });
		  });
		  }
		  });
};
</script>
<script>
    $(document)
    .hide()  // hide it initially
    .ajaxSend(function(event, jqxhr, settings) {
    if(settings.url.includes('getGuestIDs')){
      $("#wait").css("display", "block");
      }
    })
    .ajaxComplete(function(event, jqxhr, settings) {
       if(settings.url.includes('getGuestIDs')){
         var event_id = settings.url.replace("/getGuestIDs/?event_id=", "");
         timeFunction(event_id);
      }
    })
</script>
<script>
         function timeFunction(event_id) {
            setTimeout(function(){
            var url = "{% url 'download_images' 123 %}";
                  document.location.href = url.replace('123', event_id);
                   $("#wait").css("display", "none");
              }, 5000);
        }
</script>
{% endblock extra_javascript %}
